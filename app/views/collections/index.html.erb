<p style="color: green"><%= notice %></p>

<h1 class="display-4 text-center text-gray-800"> <%= t('.collection') %></h1>

<div id="collections" class="container mt-4">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th><%= t('.name') %></th>
        <th><%= t('.actions') %></th>
        <th><%= t('Estado') %></th>
      </tr>
    </thead>
    <tbody>
      <% @collections.each do |collection| %>
        <tr>
          <td><%= collection.name %></td>
          <td>
          <% if Current.user.designer? %>
            <% if collection.definir_coleccion? %>
            <%= link_to t('.view'), collection, class: "btn btn-primary" %>
              <%= link_to t('.delete'), collection, method: :delete, data: { confirm: "¿Estás seguro?" }, class: "btn btn-danger" %>
              <%= link_to t('.editar'), edit_collection_path(collection), class: "btn btn-secondary" %>  
            <% else %>
              <%= link_to t('.view'), collection, class: "btn btn-primary" %>  
            <% end %>    
          <% end %>
          <% if current_user.engineer? %>
            <% if collection.analizar_materiales? %>
              <%= link_to 'Ver proveedores', providers_path(collection_id: collection) , class: "btn btn-success" %>
            <% elsif collection.analizar_lugares?  %>
              <%= link_to 'Ver lugares', makers_path(collection_id: collection), class: "btn btn-success" %>      
            <% elsif collection.waiting_pedidos? && !collection.pending? && !collection.canceled?%>
              <%= link_to t('.view'), collection, class: "btn btn-primary" %>  
            <% elsif collection.revision_coleccion? %>
              <%= link_to t('.view'), collection, class: "btn btn-primary" %> 
            <% elsif collection.pending? %>
              <%= link_to t('.view'), collection, class: "btn btn-primary" %>  
              <%= link_to "Ver Entrega atrasada", booking_delayed_path(collection_id: collection), class: "btn btn-primary" %>  
            <% elsif collection.canceled? %>
              <%= link_to t('.view'), collection, class: "btn btn-primary" %>  
              <%= link_to "Ver posibles proveedores", booking_canceled_path(collection_id: collection), class: "btn btn-primary" %> 
            <% end %>
          <% end %>
          <% if current_user.marketing? %>
            <% if collection.waiting_pedidos? %>
              <%= link_to 'Agregar pedido', new_order_path(collection_id: collection) , class: "btn btn-success" %>
              <%= link_to 'Ver Pedidos', orders_path(collection_id: collection) , class: "btn btn-success" %>
              <% end %>
          <% end %>
          <% if current_user.logistica? %>
            <% if collection.esperando_lotes? %>
              <%= link_to 'Recepcion de lotes', recepcion_lotes_path(collection_id: collection) , class: "btn btn-success" %>
            <% end %>
          <% end %>
          </td>
          <td><%= collection.aasm_state %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <% if Current.user.designer? %>
    <%= link_to t('.new'), new_collection_path, class: "btn btn-success" %>
  <% end %>
</div>